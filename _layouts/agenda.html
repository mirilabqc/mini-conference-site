{% include partials/header.html %}
{% assign nbr_days = site.data.program.days | size %}

<h1 class="display-5 {% if nbr_days > 1 %}mb-2{% else %}mb-4{% endif %} text-break">
  {% if page.title %}
    {{ page.title }}
  {% else %}
    {{ site.data.lang[site.conference.lang].agenda.title | default: "Agenda" }}
  {% endif %}
</h1>

{{ content }}

{%- if nbr_days > 1 -%}
  <ul class="nav justify-content-center mb-3 btn-group" id="day-list" role="tablist">
    {%- for d in site.data.program.days -%}
      {%- include partials/get_day_hash.html -%}
      <li class="nav-item" role="presentation">
        <a
          class="nav-link btn btn-outline-secondary{%- if forloop.index == 1 %} active{% endif %}"
          id="tab-{{ day_hash }}"
          data-toggle="tab"
          {%- if d.date -%}{% include partials/get_talk_timestamp.html %} data-ts="{{ timestamp_start }}"{% endif %}
          href="#{{ day_hash }}"
          role="tab"
          aria-controls="{{ day_hash }}"
          aria-selected="{% if forloop.index == 1 %}true{% else %}false{% endif %}"
        >
          {{ day_name }}
        </a>
      </li>
    {%- endfor -%}
  </ul>
  <div class="tab-content" id="day-content">
{%- endif -%}

{%- for d in site.data.program.days -%}
  {%- include partials/get_day_hash.html -%}
  <div
    class="tab-pane{% if nbr_days > 1 and forloop.index == 1 %} active{% endif %}"
    id="{{ day_hash }}"
    role="tabpanel"
    aria-labelledby="tab-{{ day_hash }}"
  >
    <h2 class="mt-4 mb-3">{{ d.date | date: "%A, %B %-e, %Y" }}</h2>

    {%- comment -%} flatten and sort talks by start time {%- endcomment -%}
    {% assign flat = "" | split: "" %}
    {% for room in d.rooms %}
      {% for t in room.talks %}
        {% assign entry = t | merge: { "room": room.name } %}
        {% assign flat = flat | push: entry %}
      {% endfor %}
    {% endfor %}
    {% assign sorted = flat | sort: "time_start" %}
    {% assign by_cat = sorted | group_by: "category" %}

    {%- for grp in by_cat -%}
      <h3 class="mt-4 mb-2">{{ grp.name }}</h3>
      <table class="table mx-auto mb-4" style="max-width:800px;table-layout:fixed;width:100%">
        <tbody>
          {%- for entry in grp.items -%}
            {% assign tmeta = site.talks | where: "name", entry.name | first %}
            {% if tmeta %}
              <tr>
                <th scope="row" class="col-title text-right align-middle" style="width:80px">
                  {%- comment -%} 24hâ†’12h + AM/PM conversion {%- endcomment -%}
                  {% assign parts      = entry.time_start | split: ":" %}
                  {% assign h24        = parts[0] | plus: 0 %}
                  {% assign m         = parts[1] | plus: 0 %}
                  {% assign hh        = h24 %}
                  {% assign suffix    = "AM" %}
                  {% if hh >= 12 %}{% assign suffix = "PM" %}{% endif %}
                  {% if hh > 12  %}{% assign hh     = hh | minus: 12 %}{% endif %}
                  {% if hh == 0  %}{% assign hh     = 12 %}{% endif %}
                  {% if m < 10 %}
                    {% assign mm = "0" | append: m %}
                  {% else %}
                    {% assign mm = m %}
                  {% endif %}
                  {{ hh }}:{{ mm }} {{ suffix }}
                </th>
                <td class="col-space p-0" style="width:1px"></td>
                <td class="alert alert-{{ grp.name | downcase | replace: " ", "-" }} shadow-sm overflow-hidden">
                  {% assign talk = tmeta %}
                  <p class="mb-2">{% include partials/show_talk.html %}</p>
                  <p class="font-weight-light mb-2">{% include partials/list_speakers.html %}</p>
                  <p class="mb-1">{% include partials/list_sub_categories.html %}</p>
                </td>
              </tr>
            {% endif %}
          {%- endfor -%}
        </tbody>
      </table>
    {%- endfor -%}

  </div>
{%- endfor -%}

{%- if nbr_days > 1 -%}
  </div>
{%- endif -%}

{% include partials/footer.html %}
